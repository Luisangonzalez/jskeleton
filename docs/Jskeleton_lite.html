<!DOCTYPE html>

<html>
<head>
  <title>Jskeleton_lite.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>Jskeleton_lite.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(root, factory)</span> </span>{
<span class="hljs-pi">    'use strict'</span>;
    <span class="hljs-comment">/*globals require,define */</span>
    <span class="hljs-comment">/* jshint unused: false */</span>

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> define === <span class="hljs-string">'function'</span> &amp;&amp; define.amd) {
        define([<span class="hljs-string">'jquery'</span>,
            <span class="hljs-string">'underscore'</span>,
            <span class="hljs-string">'backbone.marionette'</span>
        ], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($, _, Marionette)</span> </span>{
            <span class="hljs-keyword">return</span> factory.call(root, root, $, _, Marionette);
        });
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">module</span> !== <span class="hljs-string">'undefined'</span> &amp;&amp; <span class="hljs-built_in">module</span>.exports) {
        <span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jquery'</span>),
            _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'underscore'</span>),
            Marionette = <span class="hljs-built_in">require</span>(<span class="hljs-string">'backbone.marionette'</span>),
            Jskeleton = factory(root, $, _, Marionette);

        root.Jskeleton = Jskeleton;
        <span class="hljs-built_in">module</span>.exports = Jskeleton;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (root !== <span class="hljs-literal">undefined</span>) {
        root.Jskeleton = factory.call(root, root, root.$, root._, root.Marionette);
    }

})(<span class="hljs-built_in">window</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(root, $, _, Marionette)</span> </span>{
<span class="hljs-pi">    'use strict'</span>;
    <span class="hljs-comment">/*globals require,requireModule */</span>
    <span class="hljs-comment">/* jshint unused: false */</span>


    <span class="hljs-keyword">var</span> Jskeleton = root.Jskeleton || {};

    Jskeleton.htmlBars = {
        compiler: requireModule(<span class="hljs-string">'htmlbars-compiler'</span>),
        DOMHelper: requireModule(<span class="hljs-string">'dom-helper'</span>).default,
        hooks: requireModule(<span class="hljs-string">'htmlbars-runtime'</span>).hooks,
        render: requireModule(<span class="hljs-string">'htmlbars-runtime'</span>).render
    };

     <span class="hljs-string">'use strict'</span>;
     <span class="hljs-comment">/*globals Marionette, Jskeleton, _ */</span>
     <span class="hljs-comment">/* jshint unused: false */</span>
    
    
     Marionette.Renderer.render = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(template, data)</span> </span>{
         data = data || {};</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>data.enviroment; //_app, channel, _view
data.templateHelpers; //Marionette template helpers view
data.serializedData; //Marionette model/collection serializedData
data.context; //View-controller context</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    
         <span class="hljs-keyword">if</span> (!template) {
             <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Marionette.Error({
                 name: <span class="hljs-string">'TemplateNotFoundError'</span>,
                 message: <span class="hljs-string">'Cannot render the template since its false, null or undefined.'</span>
             });
         }
    
         <span class="hljs-keyword">var</span> compiler = Jskeleton.htmlBars.compiler,
             DOMHelper = Jskeleton.htmlBars.DOMHelper,
             hooks = Jskeleton.htmlBars.hooks,
             render = Jskeleton.htmlBars.render;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>template = templateFunc();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    
         <span class="hljs-keyword">var</span> templateSpec = compiler.compileSpec(template, {}),
             templatePreCompiled = compiler.template(templateSpec),
             env = {
                 dom: <span class="hljs-keyword">new</span> DOMHelper(),
                 hooks: hooks,
                 helpers: Jskeleton._helpers,
                 jskeleton: data.enviroment <span class="hljs-comment">// for helper access to the enviroments</span>
             },
             scope = hooks.createFreshScope();
    
         hooks.bindSelf(env, scope, data.context);</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>template access: context (view-controller context) , templateHelpers and model serialized data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    
         <span class="hljs-keyword">var</span> dom = render(templatePreCompiled, env, scope, {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>contextualElement: output</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>         }).fragment;
    
         <span class="hljs-keyword">return</span> dom;
     };
src/helpers/html-bars.js not found
src/utils/hook.js not found
<span class="hljs-pi">    'use strict'</span>;
    <span class="hljs-comment">/*globals Jskeleton */</span>
    <span class="hljs-comment">/* jshint unused: false */</span>
    
    <span class="hljs-keyword">var</span> Router = Backbone.Router.extend({
    
        routes: {},
    
        initialize: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">this</span>.listenTo(<span class="hljs-keyword">this</span>, <span class="hljs-string">'route'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                <span class="hljs-keyword">var</span> route = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>];
                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>] &amp;&amp; <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>].length) {
                    route += <span class="hljs-string">':'</span> + <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>].join(<span class="hljs-string">':'</span>);
                }
                <span class="hljs-built_in">console</span>.log(route);
            });
        },
    
        <span class="hljs-comment">/**
         * A shorthand of app.router.route with the event name convention.
         * @memberof app.router
         * @example
         * routes names and its events names
         * user -&gt; router:route:user
         * user/profile -&gt; router:route:user:profile
         * user/:id -&gt; router:route:user
         * user(/:id) -&gt; router:route:user
         * @param {String} route   route name to listen
         * @param {Function} handler function to calls when route is satisfied
         */</span>
        addRoute: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(route, handler)</span> </span>{
            route = route || <span class="hljs-string">''</span>;
    
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'router:add:before'</span>, route);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Unify routes regexp names</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> eventName = <span class="hljs-string">'router:route:'</span> + route.split(<span class="hljs-string">'('</span>)[<span class="hljs-number">0</span>].split(<span class="hljs-string">'/:'</span>)[<span class="hljs-number">0</span>].split(<span class="hljs-string">'/'</span>).join(<span class="hljs-string">':'</span>);
    
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'router:add:after'</span>, eventName);
    
            <span class="hljs-keyword">this</span>.route(route, eventName, handler);
        },
    
        <span class="hljs-comment">/**
         * Router initialization.
         * Bypass all anchor links except those with data-bypass attribute
         * Starts router history. All routes should be already added
         * @memberof app.router
         */</span>
        init: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'router.after'</span>);
    
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'router.Backbone.history.start'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Trigger the initial route and enable HTML5 History API support, set the
root folder to ‘/‘ by default.  Change in app.js.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    
            Backbone.history.start();</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>log.debug(‘router.location.hash’, window.location.hash.replace(‘#/‘, ‘/‘));
Backbone.history.navigate(window.location.hash.replace(‘#/‘, ‘/‘), true);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        },
        start: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">this</span>.init();
        }
    });
    
    
    Router.getSingleton = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    
        <span class="hljs-keyword">var</span> instance = <span class="hljs-literal">null</span>;
    
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInstance</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (!instance) {
                instance = <span class="hljs-keyword">new</span> Router();
            }
            <span class="hljs-keyword">return</span> instance;
        }
    
        Jskeleton.router = getInstance();
        <span class="hljs-keyword">return</span> Jskeleton.router;
    };
    
    
    Router.start = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(app)</span> </span>{
        router.init();
    };
    
    Jskeleton.Router = Router;
    <span class="hljs-string">'use strict'</span>;
    <span class="hljs-comment">/*globals Marionette, Jskeleton, _ */</span>
    <span class="hljs-comment">/* jshint unused: false */</span>
    
    <span class="hljs-comment">/**
     * Reusable component as a Service
     */</span>
    <span class="hljs-keyword">var</span> Service = Marionette.Object.extend({
        constructor: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(opts)</span> </span>{
            <span class="hljs-keyword">var</span> options = opts || {},</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Todo serviceOptions ?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                serviceOptions = [<span class="hljs-string">'model'</span>, <span class="hljs-string">'collection'</span>, <span class="hljs-string">'events'</span>];
    
            _.extend(<span class="hljs-keyword">this</span>, _.pick(options, serviceOptions));
    
            <span class="hljs-keyword">this</span>.options = _.extend({}, <span class="hljs-keyword">this</span>.options, <span class="hljs-keyword">this</span>.defaults, options);
    
            <span class="hljs-keyword">if</span> (_.isFunction(<span class="hljs-keyword">this</span>.initialize)) {
                <span class="hljs-keyword">this</span>.initialize.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
            }
        }
    
    });
    
    Jskeleton.Service = Service;
    
    <span class="hljs-string">'use strict'</span>;
    <span class="hljs-comment">/*globals Marionette, Jskeleton, _, Backbone */</span>
    <span class="hljs-comment">/* jshint unused: false */</span>
    
    <span class="hljs-keyword">var</span> Application = Marionette.Application.extend({
        defaultEl: <span class="hljs-string">'body'</span>,
        defaultRegion: <span class="hljs-string">'root'</span>,
        isChildApp: <span class="hljs-literal">false</span>,
        globalChannel: <span class="hljs-string">'global'</span>,
        constructor: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> </span>{
            options = options || {};
            <span class="hljs-keyword">this</span>.aid = <span class="hljs-keyword">this</span>.getAppId();
            <span class="hljs-keyword">this</span>.rootEl = options.rootEl || <span class="hljs-keyword">this</span>.rootEl || <span class="hljs-keyword">this</span>.defaultEl;
            <span class="hljs-keyword">this</span>.router = Jskeleton.Router.getSingleton();
            <span class="hljs-keyword">if</span> (options.parentApp) {
                <span class="hljs-keyword">this</span>._childAppConstructor(options);
            }
            Marionette.Application.prototype.constructor.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>); <span class="hljs-comment">//parent constructor (super)</span>
            <span class="hljs-keyword">this</span>.applications = options.applications || <span class="hljs-keyword">this</span>.applications || {};
            <span class="hljs-keyword">this</span>._childApps = {}; <span class="hljs-comment">//instances object subapps</span>
    
        },
        start: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> </span>{
            <span class="hljs-keyword">this</span>.triggerMethod(<span class="hljs-string">'before:start'</span>, options);
            <span class="hljs-keyword">this</span>._initCallbacks.run(options, <span class="hljs-keyword">this</span>);
            <span class="hljs-keyword">this</span>._initApplications(options); <span class="hljs-comment">//init child apps</span>
            <span class="hljs-keyword">this</span>._initAppRoutesListeners(options); <span class="hljs-comment">//init child apps</span>
            <span class="hljs-keyword">this</span>._initAppEventsListeners(options); <span class="hljs-comment">//init child apps</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.parentApp) {
                <span class="hljs-keyword">this</span>.startRouter();
            }
            <span class="hljs-keyword">this</span>.triggerMethod(<span class="hljs-string">'start'</span>, options);
        },
        processNavigation: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(controllerView)</span> </span>{
            <span class="hljs-keyword">var</span> hook = <span class="hljs-keyword">this</span>.getHook();
            <span class="hljs-keyword">this</span>.triggerMethod(<span class="hljs-string">'onNavigate'</span>, controllerView, hook);
            hook.processBefore();</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>TODO: Tener en cuenta que el controller puede no pintarse “asincronamente” si tiene un flag determinado, teniendo que devolver un promesa o algo por el estilo (lanzar un evento etc.)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            controllerView.processNavigation.apply(controllerView, <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>));
            hook.processAfter();
        },
        startChildApp: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(childApp, options)</span> </span>{
            childApp.start(options);
        },
        factory: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(Class, options)</span> </span>{
            options = options || {};
            options.parentApp = <span class="hljs-keyword">this</span>;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Class(options);
        },
        startRouter: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">this</span>.router.start();
        },
        _initChannel: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{ <span class="hljs-comment">//backbone.radio</span>
            <span class="hljs-keyword">this</span>.globalChannel = <span class="hljs-keyword">this</span>.globalChannel ? Backbone.Radio.channel(<span class="hljs-keyword">this</span>.globalChannel) : Backbone.Radio.channel(<span class="hljs-string">'global'</span>);
            <span class="hljs-keyword">this</span>.privateChannel = <span class="hljs-keyword">this</span>.privateChannel ? Backbone.Radio.channel(<span class="hljs-keyword">this</span>.privateChannel) : Backbone.Radio.channel(<span class="hljs-keyword">this</span>.aid);
        },
        _childAppConstructor: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> </span>{
            <span class="hljs-keyword">this</span>.isChildApp = <span class="hljs-literal">true</span>; <span class="hljs-comment">//flag if this is a childApp</span>
            <span class="hljs-keyword">this</span>.parentApp = options.parentApp; <span class="hljs-comment">//reference to the parent app (if exist)</span>
            <span class="hljs-keyword">if</span> (!options.region) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'La sub app tiene que tener una region específica'</span>);
            }
            <span class="hljs-keyword">this</span>.region = options.region;
        },
        _initializeRegions: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isChildApp) { <span class="hljs-comment">// is a parent app (Main app)</span>
                <span class="hljs-keyword">this</span>._ensureEl(); <span class="hljs-comment">//ensure initial root DOM reference is available</span>
                <span class="hljs-keyword">this</span>._initRegionManager();
                <span class="hljs-keyword">this</span>._createRootRegion(); <span class="hljs-comment">// Create root region on root DOM reference</span>
                <span class="hljs-keyword">this</span>._createLayoutApp();
            } <span class="hljs-keyword">else</span> { <span class="hljs-comment">//is childApp</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>TODO: ensure that parent region exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            }
        },
        _ensureEl: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.$rootEl) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.rootEl) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Tienes que definir una rootEl para la Main App'</span>);
                }
                <span class="hljs-keyword">this</span>.$rootEl = $(<span class="hljs-keyword">this</span>.rootEl);
            }
        },
        _createRootRegion: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">this</span>.addRegions({
                root: <span class="hljs-keyword">this</span>.rootEl
            });
        },
        _createLayoutApp: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">this</span>.defaultRegion = <span class="hljs-string">'root'</span>;
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.layout &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.layout === <span class="hljs-string">'object'</span>) { <span class="hljs-comment">//ensure layout object is defined</span>
                <span class="hljs-keyword">this</span>.layoutTemplate = <span class="hljs-keyword">this</span>.layout.template; <span class="hljs-comment">//TODO: lanzar aserción</span>
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.layoutTemplate) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Si defines un objeto layout tienes que definir un template'</span>);
                }
                <span class="hljs-keyword">this</span>.layoutClass = <span class="hljs-keyword">this</span>.layout.layoutClass || <span class="hljs-keyword">this</span>.getDefaultLayoutClass();
                <span class="hljs-keyword">this</span>.layoutClass = <span class="hljs-keyword">this</span>.layoutClass.extend({
                    template: <span class="hljs-keyword">this</span>.layoutTemplate
                });
                <span class="hljs-keyword">this</span>._layout = <span class="hljs-keyword">this</span>.factory(<span class="hljs-keyword">this</span>.layoutClass, <span class="hljs-keyword">this</span>.layout.options);
                <span class="hljs-keyword">this</span>.root.show(<span class="hljs-keyword">this</span>._layout);
    
                <span class="hljs-keyword">this</span>._addLayoutRegions();
            }
        },
        _addLayoutRegions: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._layout.regionManager.length &gt; <span class="hljs-number">0</span>) { <span class="hljs-comment">//mirar lo del length de regions</span>
                <span class="hljs-keyword">this</span>.defaultRegion = <span class="hljs-literal">undefined</span>;
                _.each(<span class="hljs-keyword">this</span>._layout.regionManager._regions, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(region, regionName)</span> </span>{
                    self[regionName] = region; <span class="hljs-comment">//TOOD: mirar compartir instancias del region manager del layout</span>
                });
            }
        },
        _initApplications: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isChildApp) {
                <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
                _.each(<span class="hljs-keyword">this</span>.applications, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, key)</span> </span>{
                    self._initApp(key, value);
                });
                <span class="hljs-keyword">this</span>.triggerMethod(<span class="hljs-string">'applications:start'</span>);
            }
        },
        _initApp: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(appName, appOptions)</span> </span>{
            <span class="hljs-keyword">var</span> appClass = appOptions.appClass,
                startWithParent = appOptions.startWithParent !== <span class="hljs-literal">undefined</span> ? appOptions.startWithParent : <span class="hljs-literal">true</span>;
    
            appOptions.region = <span class="hljs-keyword">this</span>._getChildAppRegion(appOptions);
    
            <span class="hljs-keyword">if</span> (startWithParent === <span class="hljs-literal">true</span>) {
                <span class="hljs-keyword">var</span> instanceOptions = _.omit(appOptions, <span class="hljs-string">'appClass'</span>, <span class="hljs-string">'startWithParent'</span>),
                    instance = <span class="hljs-keyword">this</span>.factory(appClass, instanceOptions);
                <span class="hljs-keyword">this</span>._childApps[appName] = instance;
                <span class="hljs-keyword">this</span>.startChildApp(instance, instanceOptions.startOptions);
            }
        },
        _getChildAppRegion: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(appOptions)</span> </span>{
            <span class="hljs-keyword">var</span> region;
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.defaultRegion) { <span class="hljs-comment">//the default region is 'root'</span>
                <span class="hljs-keyword">if</span> (appOptions.region === <span class="hljs-literal">undefined</span> || appOptions.region === <span class="hljs-keyword">this</span>.defaultRegion) { <span class="hljs-comment">//the subapp region must be undefined or 'root'</span>
                    region = <span class="hljs-keyword">this</span>._regionManager.get(<span class="hljs-keyword">this</span>.defaultRegion); <span class="hljs-comment">//root region</span>
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Tienes que crear en la aplicación (main) la region especificada a través de un layout'</span>);
                }
            } <span class="hljs-keyword">else</span> {
                region = <span class="hljs-keyword">this</span>._layout.regionManager.get(appOptions.region);
                <span class="hljs-keyword">if</span> (!region) { <span class="hljs-comment">//the region must exists</span>
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Tienes que crear en la aplicación (main) la region especificada a través de un layout'</span>);
                }
            }
            <span class="hljs-keyword">return</span> region;
        },
        _initAppRoutesListeners: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
            <span class="hljs-keyword">this</span>._viewControllers = [];
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.routes) {
                _.each(<span class="hljs-keyword">this</span>.routes, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, key)</span> </span>{
                    self._addAppRoute(key, value);
                });
            }
        },
        _addAppRoute: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(routeString, routeOptions)</span> </span>{
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
                viewController;
            viewController = <span class="hljs-keyword">this</span>._getViewController(routeOptions);
    
            <span class="hljs-keyword">this</span>.router.route(routeString, routeOptions.triggerEvent, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                self.processNavigation.apply(self, [viewController].concat(<span class="hljs-built_in">arguments</span>));
            });
        },
        _getViewController: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> </span>{
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
                viewClass = options.view,
                template = options.template,
                viewControllerOptions = _.extend({
                    app: <span class="hljs-keyword">this</span>,
                    channel: <span class="hljs-keyword">this</span>.privateChannel,
                    service: <span class="hljs-keyword">this</span>.service,
                    region: <span class="hljs-keyword">this</span>.region
                }, options.viewControllerOptions),
                ViewControllerClass = options.viewControllerClass || <span class="hljs-keyword">this</span>.getDefaultviewController(),
                viewController;
    
            <span class="hljs-keyword">if</span> (!template) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Tienes que definir un template'</span>);
            }
    
            ViewControllerClass = <span class="hljs-keyword">this</span>.extendViewController(ViewControllerClass, template);
    
            viewController = <span class="hljs-keyword">this</span>.factory(ViewControllerClass, viewControllerOptions);
    
            <span class="hljs-keyword">this</span>._viewControllers.push(viewController);
    
            <span class="hljs-keyword">return</span> viewController;
        },
        extendViewController: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ViewControllerClass, template)</span> </span>{
            <span class="hljs-keyword">return</span> ViewControllerClass.extend({
                template: template
            });
        },
        _initAppEventsListeners: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
            <span class="hljs-keyword">this</span>._controllers = [];
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.events) {
                _.each(<span class="hljs-keyword">this</span>.events, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, key)</span> </span>{
                    self._addAppEventListener(key, value);
                });
            }
        },
        _addAppEventListener: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventName, eventOptions)</span> </span>{
            <span class="hljs-keyword">var</span> controller = <span class="hljs-keyword">this</span>._getViewController(eventOptions),
                self = <span class="hljs-keyword">this</span>;
    
            <span class="hljs-keyword">this</span>.globalChannel.on(eventName, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                self.processNavigation(controller);
            });
        },
        getChildApp: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(appName)</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._childApps[appName];
        },
        getDefaultviewController: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> Jskeleton.ViewController;
        },
        getDefaultLayoutClass: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> Marionette.LayoutView;
        },
        getHook: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Jskeleton.Hook();
        },
        getAppId: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> _.uniqueId(<span class="hljs-string">'a'</span>);
        }
    });
    
    
    Jskeleton.Application = Application;
    
        <span class="hljs-string">'use strict'</span>;
        <span class="hljs-comment">/*globals Jskeleton, Marionette, _ */</span>
    
        Jskeleton.ViewController = Marionette.LayoutView.extend({
            constructor: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> </span>{ <span class="hljs-comment">//inyectar app, channel, region</span>
                options = options || {};
                <span class="hljs-keyword">this</span>._ensureOptions(options);
                <span class="hljs-keyword">this</span>._app = options.app;
                <span class="hljs-keyword">this</span>.channel = options.channel;
                <span class="hljs-keyword">this</span>.region = options.region;
                <span class="hljs-keyword">this</span>.service = options.service;
                <span class="hljs-keyword">this</span>.context = {};
                Marionette.LayoutView.prototype.constructor.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
            },
            _ensureOptions: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> </span>{
                <span class="hljs-keyword">if</span> (!options.app) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'El view-controller necesita tener la referencia a su application'</span>);
                }
                <span class="hljs-keyword">if</span> (!options.channel) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'El view-controller necesita tener un canal'</span>);
                }
                <span class="hljs-keyword">if</span> (!options.region) { <span class="hljs-comment">// mirarlo</span>
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'El view-controller necesita tener una region específica'</span>);
                }
            },
            processNavigation: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(route)</span> </span>{
                <span class="hljs-keyword">this</span>.triggerMethod(<span class="hljs-string">'before:navigate'</span>);
    
                <span class="hljs-keyword">this</span>.triggerMethod(<span class="hljs-string">'state:change'</span>, <span class="hljs-keyword">this</span>.service, route);
    
                <span class="hljs-keyword">this</span>.renderViewController();
    
                <span class="hljs-keyword">this</span>.triggerMethod(<span class="hljs-string">'navigate'</span>);
            },
            renderViewController: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                <span class="hljs-keyword">this</span>.render();
            },
            mixinTemplateHelpers: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(target)</span> </span>{
                target = target || {};
                <span class="hljs-keyword">var</span> templateHelpers = <span class="hljs-keyword">this</span>.getOption(<span class="hljs-string">'templateHelpers'</span>);
    
                templateHelpers = Marionette._getValue(templateHelpers, <span class="hljs-keyword">this</span>);
    
    
                <span class="hljs-keyword">var</span> templateContext = {
                    enviroment: {
                        _app: <span class="hljs-keyword">this</span>._app,
                        _view: <span class="hljs-keyword">this</span>,
                        _channel: <span class="hljs-keyword">this</span>.channel
                    },
                    templateHelpers: templateHelpers,
                    context: <span class="hljs-keyword">this</span>.context, <span class="hljs-comment">// TODO: Mirar bien</span>
                    serializedData: target
                };
    
                <span class="hljs-keyword">return</span> templateContext;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>onRender: function(){</p>
<p>}
onBeforeNavigate: function(){
    //TODO: service
}
onNavigate: function(){
    //TODO: service
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        });


    <span class="hljs-keyword">return</span> Jskeleton;

});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
